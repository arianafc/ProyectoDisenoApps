<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity6">
    <head th:replace="~{layout/plantilla :: head}">
        <title>TechShop</title>
    </head>
    <body>
        <section th:fragment="listadoProductos">
            <div class="row" style="text-align: right; flex-direction: row-reverse">
                <div class="col mb-3" style="text-align: right">
                    <div sec:authorize="hasRole('ROLE_ADMIN')" class="input-group rounded" style="align-content: right">
                        <input type="search" class="form-control rounded" placeholder="Search" aria-label="Search" aria-describedby="search-addon" />
                        <span class="input-group-text border-0" id="search-addon">
                            <i class="fas fa-search"></i>
                        </span>
                    </div>
                </div>
                <div sec:authorize="hasRole('ROLE_ADMIN')" class="col">
                    <button 
                        type="button" 
                        class="btn btn-dark" >
                        <i class="fas fa-plus"></i> <a th:href="@{/producto/agregarProducto}" style="color: white">[[#{accion.agregar}]]</a>
                    </button>
                </div>
            </div>
            <div class="container">
                <div class="row">
                    <div class="col-md-12"> <!-- Ajustado para usar todo el ancho disponible -->
                        <div class="card">
                            <div class="card-header">
                                <h4>[[#{index.nuestrosProductos}]]</h4>
                            </div>
                            <div th:if="${productos != null and !productos.empty}">
                                <table class="table table-striped table-hover">
                                    <thead class="table-dark">
                                        <tr>
                                            <th>ID</th>
                                            <th>[[#{producto.productos}]]</th>
                                            <th>Status</th>
                                            <th>[[#{producto.descripcion}]]</th>
                                            <th>[[#{filtros.marca}]]</th>
                                            <th>[[#{filtros.precio}]]</th>
                                            <th>[[#{producto.existencias}]]</th>
                                            <th>[[#{producto.categoria}]]</th>
                                            <th>[[#{filtros.estilo}]]</th>
                                            <th>[[#{categoria.rutaImagen}]]</th>
                                            <th sec:authorize="hasRole('ROLE_ADMIN')">Acciones</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr th:each="producto, co : ${productos}">
                                            <td th:text="${producto.idProducto}"></td>
                                            <td th:text="${producto.nombre}"></td>
                                            <td th:text="${producto.status}"></td>
                                            <td th:text="${producto.descripcion}"></td>
                                            <td th:text="${producto.marca}"></td>
                                            <td th:text="${producto.precio}"></td>
                                            <td th:text="${producto.existencias}"></td>
                                            <td th:text="${producto.categoria.nombre}"></td>
                                            <td th:text="${producto.estilo.nombre}"></td>
                                            <td>
                                                <img th:src="${producto.rutaImagen}" height="50" alt="Imagen del producto" />
                                            </td>
                                            <td sec:authorize="hasRole('ROLE_ADMIN')">
                                                <a th:href="@{/producto/modificar/{idProducto}(idProducto=${producto.idProducto})}" style="color: #007bff; text-decoration: underline;">
                                                    [[#{accion.actualizar}]]
                                                </a>
                                                |
                                                <a th:href="@{/producto/eliminar/{idProducto}(idProducto=${producto.idProducto})}" style="color: #007bff; text-decoration: underline;">
                                                    [[#{accion.eliminar}]]
                                                </a>                                              
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            <div class="text-center p-2" th:if="${productos == null or productos.empty}">
                                <span>[[#{producto.listaVacia}]]</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>


        <section sec:authorize="hasRole('ROLE_ADMIN')" th:fragment="agregarProducto">
            <div class="container mt-3" style="margin-left: 50px">
                <div class="container mt-3" style="margin-left: 50px">
                    <div class="d-flex">
                        <h2 style="margin-right: 5px" >Hola,   <h2 sec:authentication=" name"></h2></h2>
                    </div>
                    <br>
                        <div class="card">
                            <form th:action="@{/producto/guardar}" th:object="${producto}" method="POST" class="was-validated card-body" enctype="multipart/form-data">
                                <div class="row align-items-center mt-2">
                                    <h3 class="col  card-title" style="text-align: center">[[#{producto.agregar}]]</h3>
                                </div>
                                <hr>
                                    <div class="row">
                                        <div class="col form-outline mb-3">
                                            <label class="mb-1" for="nombre" style="font-size: 20px"><h5>[[#{usuario.nombre}]]</h5></label>
                                            <input type="text" class="form-control" id="nombre" th:field="*{nombre}" style="height: 50px" required/>
                                        </div>
                                        <div class="col form-outline mb-3">
                                            <label class="mb-1" for="descripcion" style="font-size: 20px"><h5>[[#{producto.descripcion}]]</h5></label>
                                            <input type="text" class="form-control" id="descripcion" th:field="*{descripcion}" style="height: 70px" required/>
                                        </div>

                                        <div class=" col form-outline mb-3">
                                            <label style="font-size: 20px" for="categoria" class="mb-1"><h5>[[#{producto.categoria}]]</h5></label>
                                            <select name="categoria" th:field="*{categoria}" class="form-control" style="height: 50px">
                                                <option th:each="item : ${categorias}" th:value="${item.idCategoria}">
                                                    [[${item.nombre}]]
                                                </option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="row">

                                        <div class="col form-outline mb-3">
                                            <label style="font-size: 20px" for="estilo" class="mb-1"><h5>[[#{filtros.estilo]]</h5></label>
                                            <select name="estilo" th:field="*{estilo}" class="form-control" style="height: 50px">
                                                <option th:each="item : ${estilos}" th:value="${item.idEstilo}">
                                                    [[${item.nombre}]]
                                                </option>
                                            </select>
                                        </div>


                                        <div class="col form-outline mb-3">
                                            <label for="estilo"><h5>Marca</h5></label>
                                            <select style="height: 50px" name="marca" th:field ="*{marca}" class="form-control">
                                                <option th:value="Nike">Nike </option>
                                                <option th:value="Adidas">Adidas</option>
                                                <option th:value="Vans">Vans</option>
                                                <option th:value="Puma">Puma</option>
                                                <option th:value="NewBalance">New Balance</option>
                                                <option th:value="Saucony">Saucony</option>
                                            </select>
                                        </div>
                                        <div class="col form-outline mb-3">
                                            <label for="precio" class="mb-1" style="font-size: 20px"><h5>[[#{filtros.precio}]]</h5></label>
                                            <input type="number" class="form-control" id="precio" th:field="*{precio}" required style="height: 50px"/>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col form-outline mb-3">
                                            <label for="cantidad"  class="mb-1" style="font-size: 20px" ><h5>[[#{producto.existencias}]]</h5></label>
                                            <input type="number" class="form-control" id="cantidad" th:field="*{cantidad}" required style="height: 50px"/>
                                        </div>
                                        <div class="col form-outline mb-3">
                                            <label for="status"><h5>Status</h5></label>
                                            <select style="height: 50px" name="status" th:field ="*{status}" class="form-control">
                                                <option th:value="Activo">
                                                    [[#{producto.activo}]]
                                                </option>
                                                <<option th:value="Inactivo"> [[#{producto.inactivo}]]</option>
                                            </select>
                                        </div>

                                        <div class="col form-outline mb-3">
                                            <label for="imagen"><h5> [[#{categoria.imagen}]]</h5></label>
                                            <input class="form-control" type="file" name="imagenFile"  style="height: 70px" onchange="readURL(this);"/>
                                            <p></p>                         
                                        </div>
                                    </div>
                                    <hr>
                                        <div class="modal-footer">
                                            <button class="btn bg-dark text-white" type="submit"><h5>[[#{accion.guardar}]]</h5></button>
                                        </div>
                                        </form>
                                        </div>
                                        </div>
                                        </div>
                                        </section>

                                     

                                        <section th:fragment="editarProductos">
                                            <div class="container mt-5" style="margin-left: 130px">
                                                <h2 style="text-align: center">Modificar Producto</h2>
                                                <hr>
                                                    <form th:action="@{/producto/guardar}" th:object="${producto}" method="POST" class="was-validated" enctype="multipart/form-data">
                                                        <input type="hidden" name="idProducto" th:field="*{idProducto}"/>
                                                        <input type="hidden" name="rutaImagen" th:field="*{rutaImagen}"/>
                                                        <div class="row">
                                                            <div class="col-md-6">
                                                                <div class="form-group mb-3">
                                                                    <label for="nombreProducto"><h5>[[#{usuario.nombre}]]</h5></label>
                                                                    <input type="text" class="form-control" id="nombre" th:field="*{nombre}" style="height: 50px" required/>
                                                                </div>
                                                                <div class="form-group mb-3">
                                                                    <label for="descripcion"><h5>[[#{producto.descripcion}]]</h5></label>
                                                                    <textarea class="form-control" id="descripcion" th:field="*{descripcion}"  style="height: 70px" required></textarea>
                                                                </div>

                                                                <div class="form-group mb-3">
                                                                    <label for="precio"><h5>[[#{filtros.precio}]]</h5></label>
                                                                    <input type="number" class="form-control" id="precio" th:field="*{precio}"  style="height: 50px" required/>
                                                                </div>


                                                                <div class="form-group mb-3">
                                                                    <label for="cantidad"><h5>[[#{producto.existencias}]]</h5></label>
                                                                    <input type="number" class="form-control" id="cantidad" th:field="*{cantidad}"  style="height: 50px" required/>
                                                                </div>

                                                                <div class="form-group mb-3">
                                                                    <label for="idCategoria" style="font: 20px"><h5>[[#{producto.categoria}]]</h5></label>
                                                                    <select name="idCategoria" th:field ="*{categoria.idCategoria}" class="form-control" style="height: 50px">
                                                                        <option th:each="item : ${categorias}" th:value="${item.idCategoria}">
                                                                            [[${item.nombre}]]
                                                                        </option>
                                                                    </select>
                                                                </div>
                                                                <div class="form-group mb-3 mt-3">
                                                                    <label style="font-size: 20px" for="estilo" class="mb-1"><h5>[[#{filtros.estilo}]]</h5></label>
                                                                    <select name="estilo" th:field="*{estilo.idEstilo}" class="form-control" style="height: 50px">
                                                                        <option th:each="item : ${estilos}" th:value="${item.idEstilo}">
                                                                            [[${item.nombre}]]
                                                                        </option>
                                                                    </select>
                                                                </div>
                                                                <div class="form-group mb-3">
                                                                    <label for="estilo"><h5>[[#{producto.marca}]]</h5></label>
                                                                    <select style="height: 50px" name="marca" th:field ="*{marca}" class="form-control">
                                                                        <option th:value="Nike">Nike </option>
                                                                        <option th:value="Adidas">Adidas</option>
                                                                        <option th:value="Vans">Vans</option>
                                                                        <option th:value="Puma">Puma</option>
                                                                        <option th:value="NewBalance">New Balance</option>
                                                                        <option th:value="Saucony">Saucony</option>
                                                                    </select>
                                                                </div>
                                                                <div class="form-group mb-3">
                                                                    <label for="status"><h5>Status</h5></label>
                                                                    <select style="height: 50px" name="status" th:field ="*{status}" class="form-control">
                                                                        <option th:value="Activo">
                                                                            [[#{producto.activo]]
                                                                        </option>
                                                                        <<option th:value="Inactivo">[[#{producto.inactivo]]</option>
                                                                    </select>
                                                                </div>
                                                            </div>

                                                            <div class="col-md-6">
                                                                <div class="form-group">
                                                                    <label for="imagen"><h5>[[#{categoria.imagen}]]</h5></label>
                                                                    <input class="form-control" type="file" name="imagenFile"  style="height: 70px" onchange="readURL(this);"/>
                                                                    <p></p>
                                                                    <img class="mb-1" id="blah" th:src="@{${producto.rutaImagen}}" alt="your image" width="400" height="400"/>
                                                                </div>
                                                            </div>
                                                        </div>


                                                        <div class="modal-footer">
                                                            <button class="btn bg-dark text-white" type="submit"><h5>[[#{accion.guardar}]]</h5></button>
                                                        </div>
                                                    </form>

                                            </div>
                                        </section>

                                        <!-- 2 Sección principal para mostrar la informaccion de las productos -->
                                        <section sec:authorize="hasRole('ROLE_USER')" th:fragment="listadoProductosFiltrado" id="productos">
                                            <div id="resultsBlock"></div>
                                            <div class="row row-cols-3 mb-5" style="margin-right: 10px"> 
                                                <div class="card" th:each="p : ${productos}">
                                                    <figure><a th:href="@{/producto/vistaProductoDetalle/{idProducto}(idProducto=${p.idProducto})}"><img th:src="${p.rutaImagen}" 
                                                                                                                                                         class="card-img" alt="..."
                                                                                                                                                         width="50" height="300"/></a>
                                                    </figure>
                                                    <div class="card-body row">
                                                        <div class="col">
                                                            <h5 class="card-title">[[${p.nombre}]]</h5>
                                                            <p class="card-text">[['$'+${p.precio}]]</p> 
                                                        </div>

                                                    </div>
                                                </div>
                                            </div>

                                        </section>

                                        <section sec:authorize="hasRole('ROLE_USER')" th:fragment="vistaProductoDetalle">
                                            <div class="container-fluid">
                                                <div class="row mx-auto" style="justify-content: center">
                                                    <div class="col-md-4">
                                                        <img class="img-fluid" id="blah" th:src="@{${producto.rutaImagen}}" alt="your image" width="400" height="400"/>
                                                    </div>

                                                    <div class="col-md-4">
                                                        <h1 >[[${producto.nombre}]]</h1>
                                                        <hr>
                                                            <h3 >[['$'+${producto.precio}]]</h3>
                                                            <img class="mb-1" id="blah" th:src="@{${producto.rutaImagen}}" alt="your image" width="100" height="100" style="border: solid"/>
                                                            <br>
                                                                <form>
                                                                    <p></p>
                                                                    <h4>[[#{producto.talla}]]</h4>
                                                                    <select class="form-control form-control-lg" style="border-radius: 0" id="talla" aria-label="Default select example" name="talla">
                                                                        <option selected>[[#{producto.talla}]]</option>
                                                                        <option th:each="talla : ${tallas}" th:value="${talla.idProducto}" th:text="${talla.talla}" name="talla"></option>
                                                                    </select>
                                                                    <br>
                                                                        <h4>Color</h4>
                                                                        <select class="form-control form-control-lg" style="border-radius: 0" id="color" aria-label="Default select example" name="color">
                                                                            <option selected>Color</option>
                                                                            <option th:each="color : ${colores}" th:value="${color.idProducto}" th:text="${color.color}" name="color"></option>
                                                                        </select>
                                                                        <br>
                                                                            <input type="hidden" name="texto" th:value="${producto.idProducto}"/>
                                                                            <input type="hidden" name="texto" th:value="${producto.existencias}"/>
                                                                            <div >
                                                                                <button class="btn btn-lg btn-block text-white" id="addCar" name="addCar" type="button" onclick="addCard(this.form)" style="width: 300px;
                                                                                        background-color: #333333; border-radius: 0"><i class="fas fa-shopping-cart"></i> [[#{carrito.agregar}]]</button>

                                                                            </div>
                                                                            </form>
                                                                
                                                                            <div >
                                                                              
                                                                                <form th:action="@{/listaDeseos/guardar}" th:object="${producto}" method="POST">
                                                                                      <input type="hidden" name="idProducto" th:value="${producto.idProducto}">
                                                                                    <div class="card-body">
                                                                                        <button class="btn btn-lg btn-block text-white mt-2" style="width: 300px;
                                                                                                background-color: #cc0033; border-radius: 0" type="submit"><i class="fas fa-heart"></i> [[#{favoritos.favoritos}]]</button>
                                                                                    </div>
                                                                                </form>
                                                                            </div>
                                                                            <br><br><br>      
                                                                                        </div>
                                                                                        </div>
                                                                                        </div>
                                                                                        </section>

                                                                                        <section th:fragment="reseñas">
                                                                                            <div class="row mx-auto">
                                                                                                <div class="col-md-3">
                                                                                                    <form th:action="@{/producto/guardarComentario}" th:object="${producto}" method="POST" style="justify-content: center; border: solid 2px; border-bottom: 0; border-top: 0; border-left: 0; padding: 10px">
                                                                                                        <input type="hidden" name="idProducto" th:value="${producto.idProducto}">
                                                                                                            <h2 class="text-center">[[#{usuario.opina1}]]</h2>
                                                                                                            <p class="text-center">[[#{usuario.opina2}]]</p>
                                                                                                            <h5>[[#{producto.talla}]]</h5>
                                                                                                            <input type="number" name="talla" id="talla" style="border-radius: 0" class="form-control"/>
                                                                                                            <br>
                                                                                                                <h5>Color</h5>
                                                                                                                <input type="text" name="Color" id="Color" style="border-radius: 0" class="form-control"/>
                                                                                                                <br>
                                                                                                                    <h5 class="form-label" for="comentario">[[#{usuario.comentario}]]</h5>
                                                                                                                    <textarea type="text" id="comentario" style="border-radius: 0" class="form-control " name="comentario"></textarea>
                                                                                                                    <br>
                                                                                                                        <button class="btn btn-lg btn-block text-white" name="btnIngresar" type="submit" style="width: 300px; background-color: #333333; border-radius: 0">Agregar Comentario</button>
                                                                                                                        </form>
                                                                                                                        </div>
                                                                                                                        <div class="col-md-9">
                                                                                                                            <h1 class="text-center">[[#{usuario.opina3}]]</h1>
                                                                                                                            <div th:each="p, iter : ${comentarios}">
                                                                                                                                <div class="card h-100">

                                                                                                                                    <div class="card-body">
                                                                                                                                        <h5 class="card-title">[['Producto: '+${p.nombreProducto}]]</h5>
                                                                                                                                        <p class="card-text">[['Usuario: '+${p.usuario}]]</p>
                                                                                                                                        <p class="card-text">[['Fecha del comentario: '+${p.fecha}]]</p>
                                                                                                                                        <p class="card-text">;<b>[[${p.comentario}]]</b></p>
                                                                                                                                    </div>
                                                                                                                                </div>
                                                                                                                            </div>
                                                                                                                        </div>

                                                                                                                        </div>
                                                                                                                        </section>
                                                                                                                        <section th:fragment="productosRelacionados">
                                                                                                                            <h1 class="text-center">[[#{producto.relacionados}]]</h1>
                                                                                                                            <br>
                                                                                                                                <div class="container">
                                                                                                                                    <div class="row" style="margin-right: 10px" th:if="${productos.size() > 0}">

                                                                                                                                        <div th:each="p, iter : ${productos}" th:if="${p.marca == producto.marca || p.categoria == producto.categoria && iter.index < 2}" class="col-md-3 col-sm-6 mb-4">
                                                                                                                                            <div class="card h-100">
                                                                                                                                                <figure><a th:href="@{/producto/vistaProductoDetalle/{idProducto}(idProducto=${p.idProducto})}"><img th:src="${p.rutaImagen}" 
                                                                                                                                                                                                        class="card-img-top" alt="..."
                                                                                                                                                                                                        width="100%" height="200"/></a>
                                                                                                                                                </figure>
                                                                                                                                                <div class="card-body">
                                                                                                                                                    <h5 class="card-title">[[${p.nombre}]]</h5>
                                                                                                                                                    <p class="card-text">[['$'+${p.precio}]]</p>
                                                                                                                                                </div>
                                                                                                                                            </div>
                                                                                                                                        </div>
                                                                                                                                    </div>
                                                                                                                                </div>
                                                                                                                        </section>

                                                                                                                        <aside th:fragment="filtros">
                                                                                                                            <div class="p-3">
                                                                                                                                <h3>[[#{filtros.filtro}]]</h3>
                                                                                                                                <form method="GET" th:action="@{/producto/query2}">
                                                                                                                                    <div class="card">
                                                                                                                                        <h5 for="estilo" class="card-header">[[#{filtros.estilo}]]</h5>
                                                                                                                                        <div class="card-body">
                                                                                                                                            <select class="form-control form-control-lg" style="border-radius: 0" id="nombre" aria-label="Default select example" name="nombre">
                                                                                                                                                <option selected>[[#{filtros.estilo}]]</option>
                                                                                                                                                <option th:each="estilo : ${estilos}" th:value="${estilo.nombre}" th:text="${estilo.nombre}" name="nombre"></option>
                                                                                                                                            </select>


                                                                                                                                            <button type="submit" class="btn btn-dark mt-3">[[#{filtro.filtrar}]]</button>
                                                                                                                                        </div>
                                                                                                                                    </div>
                                                                                                                                </form>
                                                                                                                                <hr>
                                                                                                                                    <form method="GET" th:action="@{/producto/query3}">
                                                                                                                                        <div class="card"> 
                                                                                                                                            <h5 for="estilo" class="card-header">[[#{filtros.marca}]]</h5>
                                                                                                                                            <div class="card-body">
                                                                                                                                                <select class="form-control form-control-lg" style="border-radius: 0" id="marca" aria-label="Default select example" name="marca">
                                                                                                                                                    <option selected>[[#{filtros.marca}]]</option>
                                                                                                                                                    <option th:value="Nike" name="marca">Nike</option>
                                                                                                                                                    <option th:value="Vans" name="marca">Vans</option>
                                                                                                                                                    <option th:value="Puma" name="marca">Puma</option>
                                                                                                                                                    <option th:value="Adidas" name="marca">Adidas</option>
                                                                                                                                                    <option th:value="Saucony" name="marca">Saucony</option>
                                                                                                                                                    <option th:value="NewBalance" name="marca">New Balance</option>
                                                                                                                                                </select>
                                                                                                                                                <button type="submit" class=" btn btn-dark mt-3">[[#{filtro.filtrar}]]</button>
                                                                                                                                            </div>
                                                                                                                                        </div>
                                                                                                                                    </form>
                                                                                                                                    <hr>
                                                                                                                                        <form method="GET" th:action="@{/producto/query1}">


                                                                                                                                            <div class="card"> 
                                                                                                                                                <h5 for="precio" class="card-header" >[[#{filtros.precio}]]</h5>

                                                                                                                                                <div class="card-body">
                                                                                                                                                    <div class="mb-3">
                                                                                                                                                        <label for="precioInf">[[#{pruebas.precio.superior}]]</label>
                                                                                                                                                        <input type="number" class="form-control" 
                                                                                                                                                               th:value="${precioInf}"
                                                                                                                                                               th:name="precioInf" required="true"/>
                                                                                                                                                    </div>
                                                                                                                                                    <div class="mb-3">
                                                                                                                                                        <label for="precioSup">[[#{pruebas.precio.inferior}]]</label>
                                                                                                                                                        <input type="number" class="form-control" 
                                                                                                                                                               th:value="${precioSup}"
                                                                                                                                                               th:name="precioSup" required="true"/>
                                                                                                                                                    </div>
                                                                                                                                                    <button type="submit" class="btn btn-dark mt-3">[[#{filtro.filtrar}]]</button>
                                                                                                                                                </div>

                                                                                                                                            </div>


                                                                                                                                        </form>
                                                                                                                                        </div>

                                                                                                                                        </aside>

                                                                                                                                        </body>
                                                                                                                                        </html>
